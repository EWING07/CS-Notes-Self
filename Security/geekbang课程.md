# GeekBang course - Web Security

## Web安全之后端安全

### 文件上传漏洞

- 文件上传漏洞：上传可以在服务端执行的webshell等，例如php的一行木马代码：`?php @eval($_POST['hacker']); ?>`，然后使用post命令，将hacker字段设计成恶意代码post上去，eval命令执行恶意代码，实现攻击。

- 集成型的webshell工具：[中国菜刀](https://github.com/raddyfiy/caidao-official-version):可以用于测试，但是只有windows版。

- 当实际生活中遇到限定上传文件类型的时候，可以查看服务器配置文件内对各种文件处理的配置，通过其配置文件中的规则找到绕过的方法。例如：当网站禁止上传php后缀的文件后，你可以先查看php配置文件中对文件后缀的处理，可以修改为php3、php4、php5等上传到网站上，成功上传即完成绕过。

- 中阶：

  - 前端绕过
  - Content-Type绕过
  - 大小写绕过：根据系统来，windows大小写不敏感，linux大小写敏感
  - windows文件流特征性绕过
  - 截断绕过

- 代码审计：1）代码逻辑安全性 2）调用函数的安全性

- 漏洞链

- Fuzz模糊测试：

  在生产环境时不推荐使用，多用于非生产环境，它会生成大量异常输入，如果没有人工分析的话，可能造成生产环境崩溃。还有可能会产生大量负载，可能会对生产环境造成影响。安全检测过程中很容易由于过多访问触发安全警报，进而为后续安全检测制造障碍。

- 防御措施：
  - 文件类型检测：白名单优于黑名单
  - 使用安全的函数进行编程
  - 熟悉业务部署环境的OS、Web Server配置

### SQL注入

- 原理：发生在应用程序和数据库层的安全漏洞，主要出现在用户输入恶意SQL代码，Web应用又未对动态构造的SQL语句使用的参数进行审查时。

- GET型的SQL漏洞

  提交网页内容的时候，主要分为GET方法，POST方法，GET方法提交的内容会显示在网页URL上，通过对URL连接进行构造，可以获得超出权限的信息内容。

- > Web程序的三层架构
  >
  > 界面层 + 业务逻辑层 + 数据访问层
  >
  >  用户访问网页实际经过的流程：
  >
  > web浏览器输入的网址链接到目标服务器->业务逻辑层的web服务器从本地存储加载index.php脚本并解析->脚本连接位于数据访问层的DBMS，并执行SQL->数据访问层的DBMS返回SQL的执行结果给web server->业务逻辑层的web server将页面封装成HTML格式发送给表示层的浏览器->表示层的浏览器解析HTML并将内容呈现给用户。
  
- 危险：

  - 猜解后台数据库，盗取网址敏感信息
  - 绕过验证登入网址后台
  - 借助数据库的 存储过程进行提取等操作

  
